<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Merk-Mix â€“ mit Ton</title>
<style>
  :root{--text:#1f2937;--muted:#6b7280;--brand:#4f46e5;--ok:#22c55e;--danger:#ef4444;--card:#fff;--ring:#eef2f7}
  *{box-sizing:border-box}
  body{margin:0;background:#f7fbff;font-family:ui-rounded,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text)}
  .app{width:min(980px,92vw);margin:24px auto;background:var(--card);box-shadow:0 8px 24px rgba(15,23,42,.08);border-radius:18px;padding:clamp(16px,3vw,28px)}
  .brand{display:flex;align-items:center;gap:12px;margin-bottom:10px}
  .logo{width:52px;height:52px;border-radius:14px;display:grid;place-items:center;background:linear-gradient(135deg,#a5b4fc,#93c5fd);font-size:28px}
  h1{margin:0;font-size:clamp(1.4rem,2.3vw,2rem)}
  .muted{color:var(--muted)}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:14px;padding:12px 16px;cursor:pointer}
  .btn.secondary{background:#e5e7eb;color:#111}
  .btn.success{background:var(--ok)}
  .btn.danger{background:var(--danger)}
  .status{display:flex;gap:12px;flex-wrap:wrap;align-items:center;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid var(--ring)}
  .badge{background:#eef2ff;color:#3730a3;padding:6px 10px;border-radius:999px;font-weight:600}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:16px}
  .tile{display:grid;place-items:center;aspect-ratio:1;background:#fff;border:2px solid #e5e7eb;border-radius:18px;font-size:clamp(28px,8vw,48px);cursor:pointer;user-select:none;transition:.2s}
  .tile.show{background:#eef2ff;border-color:#c7d2fe;box-shadow:0 0 0 3px #e0e7ff inset}
  .tile.correct{background:#ecfdf5;border-color:#bbf7d0}
  .tile.wrong{background:#fef2f2;border-color:#fecaca}
  .progress{width:100%;height:10px;background:#eef2ff;border-radius:999px;overflow:hidden;margin-top:10px}
  .progress>div{height:100%;width:0;background:linear-gradient(90deg,#6366f1,#22c55e)}
  .center{text-align:center}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:50}
  .modal{background:#fff;color:#111827;border-radius:16px;width:min(520px,92vw);box-shadow:0 20px 50px rgba(0,0,0,.25);padding:20px}
  .modal h3{margin:0 0 8px}
  .modal p{margin:0 0 14px;color:#4b5563}
  .modal .actions{display:flex;gap:10px;justify-content:flex-end}
</style>
</head>
<body>
  <main class="app">
    <header class="brand">
      <div class="logo">ğŸ§©</div>
      <div>
        <h1>Merk-Mix ğŸµ</h1>
        <p class="muted">Trainiere dein GedÃ¤chtnis mit Ton! Level 1 startet mit 3 Symbolen.</p>
      </div>
    </header>

    <section id="start" class="center">
      <p>DrÃ¼cke <b>Start</b>, merke die blinkenden Symbole und deren Ton â€“ und klicke sie in derselben Reihenfolge an.</p>
      <div class="row" style="justify-content:center">
        <button id="startBtn" class="btn">â–¶ï¸ Start</button>
      </div>
    </section>

    <section id="game" style="display:none">
      <div class="status">
        <span class="badge" id="levelBadge">Level 1</span>
        <span class="badge" id="lenBadge">Symbole: 3</span>
        <span class="badge" id="scoreBadge">Punkte: 0</span>
        <span class="muted" id="phase">Merkenâ€¦</span>
      </div>
      <div class="progress"><div id="bar"></div></div>
      <div id="grid" class="grid" role="group" aria-label="Symbole"></div>
      <div class="row" style="margin-top:10px">
        <button id="repeat" class="btn secondary" disabled>ğŸ” Nochmal zeigen</button>
        <button id="next" class="btn success" disabled>â¡ï¸ Weiter</button>
        <button id="giveup" class="btn danger">â¹ï¸ Abbrechen</button>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3 id="modalTitle">Hinweis</h3>
      <p id="modalText"></p>
      <div class="actions">
        <button id="modalOk" class="btn">OK</button>
      </div>
    </div>
  </div>

  <script>
  // --- Audio ---
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  function beep(freq=500, dur=200, vol=0.08, type="sine"){
    try {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.frequency.value = freq;
      osc.type = type;
      gain.gain.value = vol;
      osc.connect(gain); gain.connect(ctx.destination);
      osc.start();
      setTimeout(()=>osc.stop(), dur);
    } catch(e){}
  }

  // --- Symbole & Spiel ---
  const SYMBOLS=["ğŸ","ğŸ¸","ğŸš—","â­ï¸","ğŸŒˆ","ğŸˆ","ğŸ²","âš½ï¸","ğŸµ","ğŸŒ","ğŸª","ğŸ±","ğŸ¶","ğŸš€","ğŸ¦Š","ğŸ§ƒ"];
  const sleep=ms=>new Promise(r=>setTimeout(r,ms));
  const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

  let level=1,len=3,score=0,seq=[],input=[],showing=false;
  const MAX=9;

  const el=id=>document.getElementById(id);
  const start=el("start"),game=el("game"),grid=el("grid");
  const levelBadge=el("levelBadge"),lenBadge=el("lenBadge"),scoreBadge=el("scoreBadge"),phase=el("phase"),bar=el("bar");
  const btnStart=el("startBtn"),btnRepeat=el("repeat"),btnNext=el("next"),btnGiveup=el("giveup");
  const modal=el("modal"),modalText=el("modalText"),modalOk=el("modalOk");

  function showModal(msg){
    modalText.textContent=msg;
    modal.style.display="flex";
    return new Promise(res=>{
      function close(){modal.style.display="none";modalOk.removeEventListener("click",close);res();}
      modalOk.addEventListener("click",close);
    });
  }

  function buildGrid(){
    grid.innerHTML="";
    shuffle([...SYMBOLS]).slice(0,9).forEach((sym,i)=>{
      const b=document.createElement("button");
      b.className="tile"; b.textContent=sym;
      b.addEventListener("click",()=>onClick(i,b));
      grid.appendChild(b);
    });
  }

  function enableInput(on){showing=!on;[...grid.children].forEach(b=>b.disabled=!on);phase.textContent=on?"Jetzt bist du dran!":"Merkenâ€¦";}

  async function showSequence(){
    enableInput(false); bar.style.width="0%"; seq=[];
    for(let i=0;i<len;i++){seq.push(Math.floor(Math.random()*MAX));}
    const tiles=[...grid.children],per=100/seq.length;
    for(let i=0;i<seq.length;i++){
      const t=tiles[seq[i]];
      beep(400+60*i,150,0.07);
      await sleep(200);
      t.classList.add("show"); bar.style.width=Math.min((i+1)*per,100)+"%";
      await sleep(500);
      t.classList.remove("show");
    }
    input=[]; enableInput(true); btnRepeat.disabled=false; btnNext.disabled=true;
  }

  async function onClick(idx,btn){
    if(showing)return;
    input.push(idx);
    beep(600+idx*30,120,0.07,"triangle");
    btn.classList.add("show"); setTimeout(()=>btn.classList.remove("show"),160);
    const p=input.length-1;
    if(input[p]!==seq[p]){
      btn.classList.add("wrong"); setTimeout(()=>btn.classList.remove("wrong"),200);
      beep(200,250,0.09,"sawtooth");
      await showModal("âŒ Falsch! Level "+level+" wird wiederholt.");
      updateBadges(); await showSequence();
      return;
    }
    if(input.length===seq.length){
      score++; scoreBadge.textContent="Punkte: "+score;
      beep(900,200,0.08,"sine");
      await showModal("ğŸ‰ Geschafft! Level "+level+" bestanden.");
      if(len<MAX){level++;len++;}
      updateBadges(); await showSequence();
    }
  }

  function updateBadges(){levelBadge.textContent="Level "+level;lenBadge.textContent="Symbole: "+len;}

  btnStart.addEventListener("click",async()=>{
    if(ctx.state==="suspended"){await ctx.resume();}
    level=1;len=3;score=0;scoreBadge.textContent="Punkte: 0";
    start.style.display="none";game.style.display="block";
    buildGrid();updateBadges();await showSequence();
  });
  btnRepeat.addEventListener("click",showSequence);
  btnNext.addEventListener("click",showSequence);
  btnGiveup.addEventListener("click",async()=>{
    await showModal("ğŸ Spiel beendet. Du hast Level "+level+" erreicht und "+score+" Punkt(e).");
    game.style.display="none";start.style.display="block";
  });
  </script>
</body>
</html>